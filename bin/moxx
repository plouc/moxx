#!/usr/bin/env node

const program   = require('commander')
const columnify = require('columnify')
const package   = require('../package.json')
const moxx      = require('../lib/moxx')


const coerceToInt = value => parseInt(value, 10)

program
    .version(package.version)
    .option('-p, --port <port>', 'The port number for the server to listen on', coerceToInt, 5000)
    .option('-d, --dir <directory>', 'The root config/mapping/files directory, default: .', '.')
    .option('-w --watch', 'Watch for changes')
    .option('-j, --journal', 'Save incoming request with no match')
    .option('-x, --proxy <proxy>', 'Act as a proxy')
    .option('--no-color', 'Disable color')
    .parse(process.argv)

console.log(`\nmoxx v${package.version}\n`)

const options = {
    dir:     program.dir,
    port:    program.port,
    watch:   !!program.watch,
    journal: !!program.journal,
    proxy:   program.proxy,
    name:    package.name,
    version: package.version,
}
console.log(`config:\n${columnify(options, { showHeaders: false })}\n`)


moxx.start(options)
